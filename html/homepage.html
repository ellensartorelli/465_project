<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>465 Final Project</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
		<script src="http://d3js.org/colorbrewer.v1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/index.css">
    <link rel="stylesheet" type="text/css" href="../css/map.css">
    <link rel="stylesheet" type="text/css" href="../css/metric.css">
    <link rel="stylesheet" type="text/css" href="../css/key.css">
    <link rel="stylesheet" type="text/css" href="../css/d3.slider.css">
    <link rel="stylesheet" type="text/css" href="../css/linegraph.css">
    <link rel="stylesheet" type="text/css" href="../css/toolbox.css">
    <script type="text/javascript" src="../scripts/nest.js"></script>
    <script type="text/javascript" src="../scripts/inflationAdjust.js"></script>
    <script type="text/javascript" src="../scripts/identifyGentrified.js"></script>
    <script type="text/javascript" src="../scripts/map.js"></script>
    <script type="text/javascript" src="../scripts/drawKey.js"></script>
    <script type="text/javascript" src="../scripts/linegraph.js"></script>
    <script type="text/javascript" src="../scripts/d3.slider.js"></script>
    <script type="text/javascript" src="../scripts/slider.js"></script>
    <script type="text/javascript" src="../scripts/createMetric.js"></script>
    <script type="text/javascript" src="../scripts/createToolbox.js"></script>
    <script type="text/javascript" src="../scripts/setTool.js"></script>
    <script type="text/javascript" src="../scripts/updateYear.js"></script>
    <script type="text/javascript" src="../scripts/clearSelection.js"></script>
    <style> form * {
  display: block;
  margin: 10px;
}</style>

  </head>
  <body>

    <div id="page_title"><p>Visualizing Gentrification in New York City</p>
    </div>
    <div id="names"><p>Ben Brown and Ellen Sartorelli</p>
    </div>
    <HR WIDTH="100%">

    <div class="container">

      <form onsubmit="download()">
        <input type="submit" value="Download">
      </form>

      <div id="top_L">
          <div id="map"></div>
      </div>

      <div id="top_R">
            <div id="linegraph"></div>
            <div id="legend_div"></div>
      </div>

      <div id="bottom_L">
            <div id="project_info">
            <h4>Export Data</h4>
            <p>The demographic data used in these visualizations originates from the <a href="http://www.s4.brown.edu/us2010/Researcher/LTBDDload/Default.aspx"><i>US2010 Longitudinal Tract Data Base</i></a> project of the Russell Sage Foundation at Brown University. Geographic data was downloaded from <a href="http://www1.nyc.gov/site/planning/data-maps/open-data/districts-download-metadata.page">New York's Department of City Planning.</a> </p>
            <p></p>
        </div>
      </div>



      <div id="bottom_R">
        <HR WIDTH="100%">
        <h3> About this Visualization</h3>
        <div id="project_info">
            <h4>Data Origin</h4>
            <p>The demographic data used in these visualizations originates from the <a href="http://www.s4.brown.edu/us2010/Researcher/LTBDDload/Default.aspx"><i>US2010 Longitudinal Tract Data Base</i></a> project of the Russell Sage Foundation at Brown University. Geographic data was downloaded from <a href="http://www1.nyc.gov/site/planning/data-maps/open-data/districts-download-metadata.page">New York's Department of City Planning.</a> </p>
            <h4>Intended Audience and Purpose</h4>
            <p>Over the past couple of decades gentrification has become one of the most debated topics amongst urbanists and geographers. While some understand gentrification as the natural process of neighborhood transition and change, others view it as white-colonization of poor minority neighborhoods. This visualization serves as an exploatory tool allowing researchers, urban planners, city officials and curious townspeople to investiage gentrification in New York City. Its functionality will allow its users to explore demographic conditions that may precurse gentrification and notice any geographic trends in its expansion. We hope for this visualization to bring awareness to the issue and provide greater insight on the details of social, economic and cultural neighborhood change.
            </p>
            <h4>Description and Encodings</h4>
            <p></p>
        </div>
      </div>
    </div>

    <script>
      var originalFeatures;
      var gentrificationYear = "2010";
      var selectedTracts = [];
      var gentrifiedTracts = [];
      var eligibleTracts = [];
      var ineligibleTracts = [];
      var downloadTracts = [];
      var features;
      var metricDict = {"mhinc": "Median Household Income", "pcol": "Percent w. College Degree", "mhv": "Median Home Value", "pblack": "Percent Black", "pwhite":"Percent White", "mrent": "Median Rent Price"};
      var metricList = [{abbr: "mhinc",name: "Median Household Income"}, {abbr: "pcol",name:"Percent w. College Degree"}, {abbr: "mhv",name:"Median Home Value"}, {abbr: "pblack",name:"Percent Black"}, {abbr: "pwhite",name:"Percent White"}, {abbr: "mrent",name:"Median Rent Price"}];
      var tools_bools = {"Selection": false, "Brushing": false, "Panning": false, "Clear All": false};
      var metric = "mhinc";
      console.log(year);
      var year = 1970;
      console.log(year);

      function redrawVis() {
        console.log("redrawing");
        for (prop in lineGraphs) {
          lineGraphs[prop].loadData( [gentrifiedTracts, eligibleTracts, ineligibleTracts, selectedTracts]
            .map(function(d){ return d.map(function(e) {
              return e.properties})
            })
          );
          lineGraphs[prop]();
        }
        //reload data and redrwaw line graphs
      }

      map_width = 775;
      map_height = 670;
      createToolbox("#map");
      createMap("#map", map_width, map_height);

      createSlider("#map", (Math.floor(map_width/2))); //
      createMetric("#top_R");

      // createToolbox("#map");
      var lineGraphs = {"mhinc": null, "pcol": null, "mhv": null, "pblack": null, "pwhite": null, "mrent": null};
      var i = 1;
      var curDiv = -1;
      for (prop in lineGraphs) {
        i++;
        if (i == 2) {
          i = 0;
          curDiv++;
          d3.select("#linegraph")
            .append("div")
            .attr("id", "row"+curDiv)
            .attr("display", "table-row");
        }
        lineGraphs[prop] = createLineGraph("#row"+curDiv, prop, 200, 200);
      }

      function download() {
        filename = "data.geojson";
        text = '{ "type": "FeatureCollection", "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },"features":'
        + JSON.stringify(selectedTracts.map(flatten))
        + '}';
    	  var element = document.createElement('a');
    	  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    	  element.setAttribute('download', filename);

    	  element.style.display = 'none';
    	  document.body.appendChild(element);

    	  element.click();

    	  document.body.removeChild(element);
    	}

      function flatten(element) {
        var newEle = {type: "Feature", properties: {}, geometry: element.geometry};
        newEle.properties.tractID = element.properties.id;
        newEle.properties.BoroName = element.properties.BoroName;
        ["black", "mhinc_unadjusted", "mhv_unadjusted", "mrent_unadjusted", "col", "pop", "white", "mhinc", "mhv_adjusted_next", "mhv", "mrent", "pwhite", "pblack", "pcol", "pcol_percent_increase", "mhv_percent_increase"].forEach(function(attribute) {
          ["1970", "1980", "1990", "2000", "2010"].forEach(function(year) {
            newEle.properties[attribute+year] = element.properties[attribute][year];
          });
        });
        return newEle;
      }

    </script>
  </body>
</html>
