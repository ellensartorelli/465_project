<!DOCTYPE html >
<html lang="en">
	<head>
		<meta charset="utf-8">
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="http://d3js.org/topojson.v1.min.js"></script>
		<script type="text/javascript" src="../scripts/nest.js"></script>

    <link rel="stylesheet" type="text/css" href="../css/map.css">
	</head>
	<body>

		<div id="map"></div>
		<div id="legend"></div>

		<script type="text/javascript">
		var width = 1200, height =1200;

		var svg = d3.select("#map")
		.append("svg")
		.attr({"width":width, "height":height});

		// put in a background to get mouse clicks
		svg.append("rect")
		.attr("class", "background")
		.attr("width", width)
		.attr("height", height);

		// create the canvas
		var canvas = svg.append("g");

		// the "zoomed" state
		var active = d3.select(null);

		// create the zoom function
		var zoom = d3.behavior.zoom()
		  .translate([0, 0])
		  .scale(1)
		  .scaleExtent([1, 8])
		  .on("zoom", zoomed);

		// load the zoom behavior into the SVG
		svg.call(zoom)
		.call(zoom.event);

		var projection = d3.geo.mercator()
   					.center([-73.94, 40.70])
   					.scale(70000)
   					.translate([(width) / 2, (height)/2]);

		// create the path tool
		var path = d3.geo.path().projection(projection);

// fetch geojson
d3.json("../data/nyct_final.topojson",function (mapData) {

	mapData.objects["nyct-final"].geometries = nest(mapData.objects["nyct-final"].geometries);

	var features = topojson.feature(mapData, mapData.objects["nyct-final"]).features;

	var paths = canvas.selectAll("path")
	.data(features)
		.enter()
		.append("path")
		.attr("d",path)
		.attr("class", "tract")
		.on("click",clicked);
	});


		/**
		Catch mouse clicks and either zoom out or zoom in depending on the current state
		**/
		function clicked(d) {
				console.log("CLICKED");
			}

		/**
		Change the apperance when we zoom
		**/
		function zoomed() {
		canvas.style("stroke-width", 1.5 / d3.event.scale + "px");
		canvas.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
		}

		// If the drag behavior prevents the default click,
		// also stop propagation so we donâ€™t click-to-zoom.
		function stopped() {
		if (d3.event.defaultPrevented) d3.event.stopPropagation();
		}

		//TODO: distinguish clicks and panning

		</script>
	</body>
</html>
